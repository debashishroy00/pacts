# PACTS Architecture Reconciliation

**Date**: October 28, 2025
**Purpose**: Reconcile conflicts between PowerPoint vision, Blueprint v3.3, and README
**Status**: DRAFT - Awaiting User Approval

---

## Documents Analyzed

1. **PowerPoint Presentation** (PACTS_Production-Ready_Autonomous_Context_Testing_System.pptx)
   - Original vision and sales pitch
   - 5-agent pipeline described
   - Success metrics and business value

2. **README.md**
   - Public-facing documentation
   - Architecture overview
   - Technology stack

3. **Blueprint v3.3** (PACTS-Build-Blueprint-v3.3.md)
   - Implementation-focused
   - Concrete code examples
   - 1-2 week MVP roadmap

---

## CONFLICT MATRIX

### Conflict 1: Agent Count and Purpose

| Source | Agent Count | Agent List |
|--------|-------------|------------|
| **PowerPoint** | 5 | Planner → POMBuilder → Generator → Executor → OracleHealer |
| **README.md** | 5 | Planner → POMBuilder → Generator → Executor → OracleHealer |
| **Blueprint v3.3** | 5 | Planner → POMBuilder → Executor → OracleHealer → VerdictRCA |

**CONFLICT**:
- PowerPoint/README: Has **Generator** agent (creates test.py files)
- Blueprint v3.3: Removes Generator, adds **VerdictRCA** (reporting/analysis)

---

### Conflict 2: Code Generation vs Runtime Execution

| Source | Approach | Output |
|--------|----------|--------|
| **PowerPoint** | "Generate production-ready Playwright Python tests" | test.py files |
| **README.md** | "Generates test.py with async/await patterns" | test.py, fixtures.json, data_loaders.py |
| **Blueprint v3.3** | "Direct Playwright execution" (runtime only) | No files - in-memory execution |

**CONFLICT**:
- PowerPoint/README: Test **generation** system (creates files)
- Blueprint v3.3: Test **execution** system (no files generated)

**Impact**: These are fundamentally different products!

---

### Conflict 3: VerdictRCA Agent

| Source | Has VerdictRCA? | Purpose |
|--------|-----------------|---------|
| **PowerPoint** | ❌ No | N/A |
| **README.md** | ❌ No | N/A |
| **Blueprint v3.3** | ✅ Yes | "Verdict, RCA, quarantine flag" |

**CONFLICT**:
- VerdictRCA is new in Blueprint v3.3
- Not mentioned in original vision
- Seems valuable for reporting/analysis

**Question**: Is this replacing OracleHealer's reporting duties?

---

### Conflict 4: Agent Responsibilities

#### Generator Agent (PowerPoint/README)

```
Input: plan.json, form.json
Output: test.py, fixtures.json, data_loaders.py
Purpose: Code synthesis - create Playwright test files
```

**What Blueprint v3.3 does instead:**
- Executor runs actions directly from intents
- No code generation step
- Faster but no persistent test artifacts

#### VerdictRCA Agent (Blueprint v3.3 only)

```
Input: Execution results, failure states
Output: Verdict, RCA report, quarantine flag
Purpose: Post-execution analysis and reporting
```

**What PowerPoint/README does instead:**
- OracleHealer handles both healing AND reporting
- Execution report generated by Executor

---

### Conflict 5: Memory Systems

| Source | Memory Systems |
|--------|----------------|
| **PowerPoint** | 4 types: Episodic, Semantic, Procedural, Working |
| **README.md** | 4 types: Episodic, Semantic, Procedural, Working |
| **Blueprint v3.3** | 3 types: Postgres Checkpointer, Redis POM Cache, Intent Memory |

**CONFLICT**:
- PowerPoint/README: Conceptual 4-memory architecture
- Blueprint v3.3: Simplified to practical implementations

**Analysis**: Not really a conflict - Blueprint simplifies implementation while achieving same goals

---

### Conflict 6: Technology Stack

| Component | PowerPoint/README | Blueprint v3.3 |
|-----------|-------------------|----------------|
| **LangGraph** | 0.1.0 | >=1.0.0,<2.0.0 (GA version) |
| **Playwright** | 1.40+ | >=1.45,<2.0 |
| **Python** | 3.11+ | 3.11+ ✅ Match |
| **CLI** | Custom or Typer | Simple custom CLI |
| **MCP** | Core component | Optional (later) |

**CONFLICT**:
- PowerPoint/README: MCP as core runtime component
- Blueprint v3.3: Direct Playwright first, MCP optional

---

## CORE QUESTION: What Product Are We Building?

### Option A: Test Generator (PowerPoint Vision)

**Flow:**
```
Excel Requirement
  → Planner (parse)
  → POMBuilder (discover selectors)
  → Generator (create test.py)
  → Executor (run test.py)
  → OracleHealer (fix and re-run)
```

**Output**: Playwright test.py files users can commit to git

**Value Proposition:**
- "Generate production-ready Playwright Python tests"
- QA teams get actual test files
- Tests can be reviewed, edited, version controlled
- Standard pytest workflow

**Timeline**: 6-8 weeks (more complex)

---

### Option B: Runtime Executor (Blueprint v3.3)

**Flow:**
```
Excel Requirement
  → Planner (parse)
  → POMBuilder (discover selectors)
  → Executor (run actions directly)
  → OracleHealer (heal failures)
  → VerdictRCA (report)
```

**Output**: Execution reports, no test files

**Value Proposition:**
- Fast execution from requirements
- No test maintenance (tests are requirements)
- Self-healing on every run
- Simpler architecture

**Timeline**: 1-2 weeks (simpler MVP)

---

## CRITICAL DECISIONS NEEDED

### Decision 1: Include Generator Agent?

**Option 1A: YES - Keep Generator (PowerPoint Vision)**
- More complex but delivers test files
- Aligns with original vision
- Better for teams wanting traditional test artifacts

**Option 1B: NO - Skip Generator for MVP (Blueprint v3.3)**
- Faster MVP (1-2 weeks)
- Simpler architecture
- Can add later if needed

**Option 1C: HYBRID - Both modes**
- Runtime execution (fast)
- Optional "save to test.py" mode
- Best of both worlds but most complex

---

### Decision 2: Include VerdictRCA Agent?

**Option 2A: YES - Add VerdictRCA as 6th agent**
- Separation of concerns (healing vs reporting)
- Cleaner architecture
- Better observability

**Option 2B: NO - Keep OracleHealer doing both**
- Stick to 5-agent architecture
- Simpler state machine
- OracleHealer does healing + reporting

**Option 2C: MERGE - VerdictRCA replaces part of OracleHealer**
- Split OracleHealer into two agents:
  - OracleHealer (healing only)
  - VerdictRCA (reporting/analysis)

---

### Decision 3: MCP Integration Timeline

**Option 3A: Core component (PowerPoint)**
- MCP as primary browser interface
- More setup complexity
- Better for enterprise deployments

**Option 3B: Optional later (Blueprint v3.3)**
- Start with direct Playwright
- Add MCP bridge in v2.0
- Faster MVP

---

### Decision 4: Memory Architecture

**Option 4A: Four conceptual memories (PowerPoint)**
- Episodic, Semantic, Procedural, Working
- Clearer conceptual model
- More documentation needed

**Option 4B: Three practical implementations (Blueprint v3.3)**
- Postgres Checkpointer, Redis Cache, Intent Memory
- Implementation-focused
- Maps to PowerPoint concepts but simplified

---

## RECOMMENDED RECONCILIATION

### Phase 1: MVP (Weeks 1-2) - Runtime Executor

**Architecture:**
```
5 Agents: Planner → POMBuilder → Executor → OracleHealer → VerdictRCA
```

**Why 5 not 6?**
- Remove Generator from MVP
- Add VerdictRCA for better reporting
- Runtime execution only

**Agent Purposes:**
1. **Planner**: Parse Excel → intents
2. **POMBuilder**: Find-First discovery → verified selectors
3. **Executor**: Execute actions with 5-point gate
4. **OracleHealer**: Heal failures (reprobe, reveal, stability wait)
5. **VerdictRCA**: Generate reports, RCA, metrics

**Output**: Execution reports, LangSmith traces, no test files

**Technology:**
- LangGraph 1.0 GA
- Direct Playwright (no MCP)
- Postgres + Redis
- Python only

**Timeline**: 1-2 weeks

---

### Phase 2: Add Generator (Weeks 3-4) - Test File Generation

**Architecture:**
```
6 Agents: Planner → POMBuilder → Generator → Executor → OracleHealer → VerdictRCA
```

**New Agent:**
- **Generator**: Takes successful execution trace, generates test.py

**New Outputs:**
- test.py files
- fixtures.json
- data_loaders.py

**Use Cases:**
- Teams wanting traditional test artifacts
- Version control test files
- Human review/edit tests
- Standard pytest workflow

**Timeline**: +2 weeks after MVP

---

### Phase 3: Enterprise Features (Weeks 5-8)

- MCP integration (optional)
- Advanced healing strategies
- Semantic memory learning
- Dashboard/UI
- Multi-tenant support

---

## PROPOSED UNIFIED ARCHITECTURE

### Core: 5 Agents (MVP) + Generator (Optional)

```
┌─────────────────────────────────────────────────────────────┐
│                    EXCEL REQUIREMENTS                        │
│              (External Ground Truth - REQ-001)               │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  AGENT 1: PLANNER                                           │
│  Parse Excel → intents + expected outcomes                   │
│  Output: context["intents"], context["expected"]             │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  AGENT 2: POMBUILDER                                         │
│  Find-First multi-strategy discovery                         │
│  5-point gate validation                                     │
│  Output: context["plan"] with verified selectors             │
└─────────────────────────────────────────────────────────────┘
                              ↓
                    ┌─────────┴─────────┐
                    │                   │
          ┌─────────▼────────┐    ┌────▼──────────────┐
          │  RUNTIME MODE    │    │  GENERATION MODE  │
          │  (Phase 1 MVP)   │    │  (Phase 2)        │
          └─────────┬────────┘    └────┬──────────────┘
                    │                   │
          ┌─────────▼────────┐    ┌────▼──────────────┐
          │  AGENT 3:        │    │  AGENT 3:         │
          │  EXECUTOR        │    │  GENERATOR        │
          │  (Direct exec)   │    │  (Create test.py) │
          └─────────┬────────┘    └────┬──────────────┘
                    │                   │
                    │             ┌────▼──────────────┐
                    │             │  AGENT 4:         │
                    │             │  EXECUTOR         │
                    │             │  (Run test.py)    │
                    │             └────┬──────────────┘
                    │                   │
                    └─────────┬─────────┘
                              ↓
                    ┌─────────────────┐
                    │  Failed?        │
                    │  Yes → Healer   │
                    │  No  → Verdict  │
                    └─────────┬───────┘
                              ↓
              ┌───────────────┴────────────────┐
              │                                │
    ┌─────────▼────────┐          ┌──────────▼─────────┐
    │  AGENT 4/5:      │          │  AGENT 5/6:        │
    │  ORACLEHEALER    │          │  VERDICTRCA        │
    │  Heal failures   │◄─────────│  Report + metrics  │
    │  Retry           │  retry   │                    │
    └──────────────────┘          └────────────────────┘
```

### Memory Systems (Unified)

| Blueprint v3.3 | PowerPoint Concept | Implementation |
|----------------|-------------------|----------------|
| Postgres Checkpointer | Episodic Memory | LangGraph state persistence |
| Redis POM Cache | Procedural Memory | Selector confidence + last success |
| Intent Memory | Semantic Memory | Intent → selector mapping |
| (Runtime state) | Working Memory | Redis session cache |

**All four conceptual memories mapped to practical implementations!**

---

## FILES TO UPDATE/CREATE

### Update Existing:
1. **README.md** - Fix merge conflict, align with reconciled architecture
2. **requirements.txt** - Update to Blueprint v3.3 versions

### Create New:
3. **ARCHITECTURE-FINAL.md** - Unified architecture (this becomes the source of truth)
4. **AGENT-SPECS.md** - Detailed specs for each agent
5. **MEMORY-SYSTEMS.md** - How 4 conceptual memories map to implementations
6. **ROADMAP.md** - Phase 1 (MVP), Phase 2 (Generator), Phase 3 (Enterprise)

### Implementation (After approval):
7. Start project structure per Blueprint v3.3 layout
8. Implement Phase 1 MVP (5 agents, runtime execution)
9. Add Phase 2 Generator when MVP validates

---

## QUESTIONS FOR USER APPROVAL

### Q1: Agent Architecture
**Do you approve this reconciled agent architecture?**
- Phase 1 MVP: 5 agents (Planner, POMBuilder, Executor, OracleHealer, VerdictRCA)
- Phase 2: Add Generator as 6th agent for test file creation
- Rationale: Faster MVP, can add Generator later

**Options:**
- [ ] A: Approve reconciled architecture (5 agents → 6 agents)
- [ ] B: Must have Generator in MVP (6 agents from start)
- [ ] C: Never need Generator (5 agents forever, runtime only)

---

### Q2: VerdictRCA Agent
**Should we include VerdictRCA as a separate agent?**
- Pro: Cleaner separation (healing vs reporting)
- Con: 6 agents total if we add Generator later

**Options:**
- [ ] A: Yes - VerdictRCA as separate agent (better architecture)
- [ ] B: No - OracleHealer does healing + reporting (simpler)
- [ ] C: Merge into Executor (Executor reports its own results)

---

### Q3: Technology Decisions
**Confirm technology stack:**
- LangGraph 1.0 GA (not 0.1.0) ✅
- Direct Playwright (no MCP for MVP) ✅
- Python only (no TypeScript) ✅
- Postgres + Redis ✅

**Options:**
- [ ] A: Approve Blueprint v3.3 stack
- [ ] B: Changes needed (specify below)

---

### Q4: Timeline & Priorities
**What's most important?**

**Options:**
- [ ] A: Speed (1-2 week MVP) - Start with runtime execution
- [ ] B: Completeness (6-8 weeks) - Include Generator from start
- [ ] C: Flexibility (2-4 weeks) - Build both modes in MVP

---

### Q5: Success Criteria for MVP
**What must Phase 1 MVP demonstrate?**

Check all that apply:
- [ ] Find-First verification (95%+ selector discovery)
- [ ] 5-point actionability gate
- [ ] Runtime execution of Excel requirements
- [ ] Autonomous healing (70%+ success)
- [ ] LangSmith observability
- [ ] Generate test.py files (requires Generator agent)
- [ ] Postgres state persistence
- [ ] Redis caching

---

## NEXT STEPS (After User Approval)

1. User reviews this reconciliation
2. User answers Q1-Q5 above
3. Create ARCHITECTURE-FINAL.md based on decisions
4. Update README.md to match final architecture
5. Create project structure
6. Begin implementation

---

**Status**: ⏸️ AWAITING USER APPROVAL
**Date**: October 28, 2025
**Version**: 1.0
